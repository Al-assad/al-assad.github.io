[{"content":"A software engineer who occasionally ponders some odd questions, functional programming fanatic with a focus on Scala3, Cloud Native and Big Data Domain.\nMy personal open-source project repository: ğŸ˜†LinsOSS\nRecent Letâ€˜s Expand Citus Co-location Single-Shard Distributed Tables 26 October 2023\u0026middot;5 mins citus postgres Explores how to enhance Citus for managing single-shard distributed tables that should be co-located efficiently, particularly in multi-tenant environments. Hacker News Digest - 2023.06.22 22 June 2023\u0026middot;2 mins hacker news æ¢ç´¢äº‘åŸç”Ÿé¢†åŸŸçš„å¤šæ ·æ€§æ™¯è§‚, Quirky, Hashing, DevPod: æ— æœåŠ¡å•†é”å®šçš„ä»£ç å³å¼€å‘ç¯å¢ƒå¹³å°, Exit traps è®©ä½ çš„ Bash è„šæœ¬æ›´åŠ å¥å£®, pg_easy_replicate å®ç°é›¶åœæœºçš„ Postgres ç‰ˆæœ¬è¿ç§» Hacker News Digest - 2023.06.19 19 June 2023\u0026middot;1 min hacker news Novelï¼šNotion é£æ ¼çš„æ–‡æœ¬ç¼–è¾‘å™¨, Bloopï¼šåŸºäº GPT-4 ä»£ç åº“é˜…è¯»å·¥å…·, Dolt: Git ç‰ˆæœ¬åŒ–æ•°æ®, Resend: ç°ä»£åŒ–é‚®ä»¶å‘é€ API å¹³å°, é€šè¿‡ Stable Diffusion åˆ¶ä½œè‰ºæœ¯åŒ–çš„äºŒç»´ç  åœ¨ Postgres ä¸Šå¤åˆ» AskBendï¼ 16 April 2023\u0026middot;2 mins postgres gpt èµ·å› æ˜¯åœ¨ 3 æœˆçš„æ—¶å€™åˆ·åˆ° Databend ai_to_sql çš„ä¸€æ¡ PR, feat: add ai_to_sql transalte natual lanauge to SQL based on your table schema by BohuTANG \u0026hellip; ","date":"26 October 2023","permalink":"/","section":"","summary":"A software engineer who occasionally ponders some odd questions, functional programming fanatic with a focus on Scala3, Cloud Native and Big Data Domain.\nMy personal open-source project repository: ğŸ˜†LinsOSS\nRecent Letâ€˜s Expand Citus Co-location Single-Shard Distributed Tables 26 October 2023\u0026middot;5 mins citus postgres Explores how to enhance Citus for managing single-shard distributed tables that should be co-located efficiently, particularly in multi-tenant environments.","title":""},{"content":"","date":"26 October 2023","permalink":"/tags/citus/","section":"Tags","summary":"","title":"citus"},{"content":"In a multi-tenant scenario, Citus adeptly handles tenant partitioning for tables with the same structure while maintaining a robust co-location strategy.\nHowever, when dealing with tables possessed by different tenants with completely distinct structures, especially when these tables have relatively small data volumes (e.g., an average total row count not exceeding 5000), the direct use of Citus\u0026rsquo;s distributed tables may not yield the desired results. The query performance may suffer due to the presence of multiple partitions, especially when these partitions are distributed across different nodes. In such cases, it is often more effective to store the table on a standard PostgresSQL node.\nIn this use case, our objective is to achieve tenant data co-location on multiple nodes for single-shard tables, with each table maintaining only one replica, much like a standalone PostgresSQL instance. We aim to ensure that co-located data (belonging to the same tenant) resides on the same physical node, all while leveraging Citus\u0026rsquo;s inherent sharding and rebalancing capabilities.\nHow to Implement ? # One approach to achieving this is by encapsulating native PostgreSQL tables into a single-shard Citus distributed table and using Citus\u0026rsquo;s sharding strategy to schedule it onto the correct nodes. This enables the goal of having a small, single-node storage table co-located with corresponding Citus distributed tables for other tenants.\nWe can achieve this behavior in a lightweight manner through the use of a Postgres User-Defined Function (UDF) Extension.\nPostgres Extension Code # -- Citus single shard table udf -- init global tid_mark table create or replace procedure citus.init_tid_mark() language plpgsql as $$ declare tid_mark_count int; begin -- create global tid_mark table create table if not exists citus.tid_mark ( tid text primary key ); -- create distributed table for tid_mark select count(*) from citus_tables where table_name = \u0026#39;citus.tid_mark\u0026#39;::regclass into tid_mark_count; if (tid_mark_count = 0) then perform create_distributed_table(\u0026#39;citus.tid_mark\u0026#39;, \u0026#39;tid\u0026#39;); end if; end; $$; -- whether the table contains only one single shard create or replace function citus.is_single_shard_table(tbl_name text) returns boolean language plpgsql as $$ declare r boolean; begin select count(shardid) = 1 from citus_shards where table_name = tbl_name::regclass into r; return r; end; $$; -- whether the single shard table need to be rebalanced create or replace function citus.is_single_shard_table_colocated(tbl_name text, tid text) returns boolean language plpgsql as $$ declare ori_nodename text; ori_nodeport integer; target_nodename text; target_nodeport integer; begin if citus.is_single_shard_table(tbl_name) = false then return true; else select nodename, nodeport from citus_shards where table_name = tbl_name::regclass into ori_nodename, ori_nodeport; select nodename, nodeport from citus_shards where shardid = (select shardid from pg_dist_shard where logicalrelid = \u0026#39;citus.tid_mark\u0026#39;::regclass and (select hashtext(tid)) between shardminvalue::integer and shardmaxvalue::integer limit 1) into target_nodename, target_nodeport; return not (ori_nodename = target_nodename and ori_nodeport = target_nodeport); end if; end; $$; -- co-locate the single shard table in citus cluster create or replace function citus.colocate_single_shard_table(tbl_name text, tid text) returns record language plpgsql as $$ declare shard_id bigint; ori_nodename text; ori_nodeport integer; target_nodename text; target_nodeport integer; r record; begin if citus.is_single_shard_table(tbl_name) = false then return r; else select shardid, nodename, nodeport from citus_shards where table_name = tbl_name::regclass into shard_id, ori_nodename, ori_nodeport; select nodename, nodeport from citus_shards where shardid = (select shardid from pg_dist_shard where logicalrelid = \u0026#39;citus.tid_mark\u0026#39;::regclass and (select hashtext(tid)) between shardminvalue::integer and shardmaxvalue::integer limit 1) into target_nodename, target_nodeport; select shard_id, target_nodename, target_nodeport into r; if (ori_nodename = target_nodename and ori_nodeport = target_nodeport) then return r; else perform citus_move_shard_placement(shard_id, ori_nodename, ori_nodeport, target_nodename, target_nodeport); return r; end if; end if; end; $$; -- randomly place the single shard table create or replace function citus.randomly_single_shard_table(tbl_name text) returns record language plpgsql as $$ declare shard_id bigint; ori_nodename text; ori_nodeport integer; target_nodename text; target_nodeport integer; r record; begin if citus.is_single_shard_table(tbl_name) = false then return r; else select shardid, nodename, nodeport from citus_shards where table_name = tbl_name::regclass into shard_id, ori_nodename, ori_nodeport; select node_name, node_port from citus_get_active_worker_nodes() order by random() limit 1 into target_nodename, target_nodeport; select shard_id, target_nodename, target_nodeport into r; if (ori_nodename = target_nodename and ori_nodeport = target_nodeport) then return r; else perform citus_move_shard_placement(shard_id, ori_nodename, ori_nodeport, target_nodename, target_nodeport); return r; end if; end if; end; $$; -- create a distributed table with only one shard create or replace function citus.create_single_shard_distributed_table(tbl_name text) returns void language plpgsql as $$ declare ns_space text; rel_name text; has_pri_col boolean; shard_col text; begin select nspname, relname from pg_catalog.pg_class as c join pg_catalog.pg_namespace as ns on c.relnamespace = ns.oid where c.oid = tbl_name::regclass::oid into ns_space, rel_name; select count(column_name) \u0026gt; 0 from information_schema.key_column_usage where table_catalog = current_database() and table_schema = ns_space and table_name = rel_name into has_pri_col; if (has_pri_col) then -- using the first primary key column as shard key select column_name from information_schema.key_column_usage where table_catalog = current_database() and table_schema = ns_space and table_name = rel_name order by ordinal_position limit 1 into shard_col; perform create_distributed_table(tbl_name, shard_col, shard_count := 1); else -- using the first column as shard key select column_name from information_schema.columns where table_catalog = current_database() and table_schema = ns_space and table_name = rel_name order by ordinal_position limit 1 into shard_col; perform create_distributed_table(tbl_name, shard_col, shard_count := 1); end if; end ; $$; Usage # Initialize global distribution identifier after the citus cluster initialization is complete:\ncall citus.init_tid_mark() Create a distributed single shard table, there are two shard placement strategies:\nCo-located with tenant-id: citus.colocate_single_shard_table Random distribution: citus.randomly_single_shard_table -- create a local table on coordinator node create table test ( f1 text, f2 int, f3 int ); -- wrapper the local table \u0026#39;test\u0026#39; as distributed single shard table select citus.create_single_shard_distributed_table(\u0026#39;test\u0026#39;) -- strategy A: co-located with tenent-id select citus.colocate_single_shard_table(\u0026#39;test\u0026#39;, \u0026#39;f1741e9e-fbbb-41f3-9160-77109a073f75\u0026#39;) -- strategy B: random distributed select citus.randomly_single_shard_table(\u0026#39;test\u0026#39;) By default, the first primary key column of the wrapped table or this first normal column (in case it does not contain any primary key) is used as the shard column of the citus distributed table.\nWhen the citus cluster is scaling out, consider rebalancing distributed single shard table to the correct tenent_id co-located node:\nselect citus.colocate_single_shard_table(\u0026#39;test\u0026#39;) Of course, the distributed single shard table itself is a citus distributed table and can be converted to a citus native distributed table at any time.\n-- convert to citus native distributed table select alter_distributed_table(\u0026#39;test\u0026#39;, distribution_column := \u0026#39;f2\u0026#39;, shard_count := 32) ","date":"26 October 2023","permalink":"/posts/expand-citus-single-shard-table/","section":"Posts","summary":"Explores how to enhance Citus for managing single-shard distributed tables that should be co-located efficiently, particularly in multi-tenant environments.","title":"Letâ€˜s Expand Citus Co-location Single-Shard Distributed Tables"},{"content":"","date":"26 October 2023","permalink":"/tags/postgres/","section":"Tags","summary":"","title":"postgres"},{"content":"","date":"26 October 2023","permalink":"/tags/","section":"Tags","summary":"","title":"Tags"},{"content":"","date":"22 June 2023","permalink":"/tags/hacker-news/","section":"Tags","summary":"","title":"hacker news"},{"content":" Reading on Craft.do 2023.06.20 - 06.22\næ¢ç´¢äº‘åŸç”Ÿé¢†åŸŸçš„å¤šæ ·æ€§æ™¯è§‚ # Explore the Variety of Cloud-Native Landscape: the Dynamic World of Kubernetes and Beyond, Seifeddine Rajhi.\nhttps://itnext.io/explore-the-variety-of-cloud-native-landscape-the-dynamic-world-of-kubernetes-and-beyond-dbf14d73d22c\næ–‡ç« ä»ä»¥ä¸‹ 6 ä¸ªæ–¹é¢ç³»ç»Ÿåœ°æ¢³ç†äº† CNCF ç”Ÿæ€çš„ä¸»è¦ç±»åˆ«æ™¯è§‚ï¼š\nä¾›åº”å•†ï¼ˆProvisioningï¼‰ï¼› è¿è¡Œæ—¶ï¼ˆRuntimeï¼‰ï¼› ç¼–æ’ç®¡ç†ï¼ˆOrchestration \u0026amp; Managementï¼‰ï¼› åº”ç”¨å¼€å‘ï¼ˆApp Definition \u0026amp; Developmentï¼‰ï¼› å¯è§‚æµ‹æ€§åˆ†æï¼ˆObservability \u0026amp; Analysisï¼‰ï¼› å¹³å°ï¼ˆPlatformsï¼‰ å¾ˆé€‚åˆä½œä¸ºäº†è§£äº‘åŸç”Ÿç”Ÿæ€æ¦‚è§ˆçš„å…¥é—¨æ–‡ç« ï¼Œå¦ï¼Œè¿™å¼  meme æˆ‘åŒæ‰‹èµåŒ ğŸ™ŒğŸ»ã€‚\nQuirky: AI åˆ¶ä½œç‚«é…·äºŒç»´ç å·¥å…· # replicate/quirky An open-source tool for making really cool QR codes with AI JavaScript 196 20 åœ¨ Hacker News Digest - 2023.06.19 ä¸­ä»‹ç»äº†æ–‡ç« ã€Šå¦‚ä½•é€šè¿‡ Stable Diffusion ç”Ÿæˆè‰ºæœ¯äºŒç»´ç ã€‹ï¼ŒQuirky å¸¦æ¥äº†ä¸€ä¸ªäº‘ä¸Šçš„ç‰ˆæœ¬ï¼ŒåŸºäº Replicate äº‘æœºå™¨å­¦ä¹ å¹³å°å’Œ Multi-ControlNet åˆ†å±‚æ§åˆ¶æ¨¡å‹ï¼Œå¯ä»¥ç›´æ¥è®¿é—® quirky.replicate.dev è¿›è¡Œä½“éªŒã€‚\nHN Refï¼š https://news.ycombinator.com/item?id=36411246\nHashingï¼šå›¾è§£å“ˆå¸Œå‡½æ•°åŸç† # https://samwho.dev/hashing/\næ–‡ç« ä»¥å›¾ä¾‹ã€å¯è§†åŒ–äº¤äº’çš„å½¢å¼è§£é‡Šäº† Hash å‡½æ•°çš„å·¥ä½œåŸç†ï¼Œä»‹ç»äº† Hash å‡½æ•°çš„ä¸€ä¸ªé‡è¦çš„è¯„ä¼°æ ‡å‡†é›ªå´©æ•ˆåº”ï¼ˆAvalanche Effectï¼‰ã€‚ç€é‡å¯¹æ¯”äº† murmur3 å’Œ stringSum ä¸¤ç§ Hash ç®—æ³•ï¼Œä»¥å¯è§†åŒ–äº’åŠ¨çš„æ–¹å¼æ¼”ç¤ºäº† murmur3 å¦‚ä½•é€šè¿‡ randomisation è§£å†³é«˜ç›¸ä¼¼è¾“å…¥å¼•å‘çš„å†²çªã€‚\nHN Refï¼š https://news.ycombinator.com/item?id=36401747\nDevPodï¼šæ— æœåŠ¡å•†é”å®šçš„ä»£ç å³å¼€å‘ç¯å¢ƒå¹³å° # loft-sh/devpod Codespaces but open-source, client-only and unopinionated: Works with any IDE and lets you use any cloud, kubernetes or just localhost docker. Go 4901 217 ç±»ä¼¼ Coder çš„ä»£ç å³å¼€å‘ç¯å¢ƒå¹³å°ï¼ˆDev-environment-as-codeï¼‰ï¼Œ Codespaces çš„å¼€æºæ›¿ä»£å“ã€‚å¯ä»¥åœ¨ä»»æ„åŸºç¡€è®¾æ–½å¯åŠ¨å¯å¤åˆ¶çš„å¼€å‘ç¯å¢ƒï¼Œå…¼å®¹ Intellijã€VSCode ç­‰ä¸»æµ IDEï¼Œæ”¯æŒæœ¬åœ° Dockerã€Kubernetesã€GCPã€AWSã€Azure ç­‰åŸºç¡€è®¾æ–½ä¾›åº”æ–¹ã€‚\nHN Refï¼š https://news.ycombinator.com/item?id=36407477\n\u0026ldquo;Exit traps\u0026rdquo; è®©ä½ çš„ Bash è„šæœ¬æ›´åŠ å¥å£® # How \u0026ldquo;Exit Traps\u0026rdquo; Can Make Your Bash Scripts Way More Robust And Reliable.\nhttp://redsymbol.net/articles/bash-exit-traps/\næ–‡ç« ä»‹ç»äº†åœ¨ Bash script ä¸­ä½¿ç”¨ exit traps æ¥å®ç°è¿‡è„šæœ¬è¿‡æ—©é€€å‡ºæ—¶çš„èµ„æºæ¸…ç†è¡Œä¸ºï¼Œä»è€Œæé«˜è„šæœ¬çš„å¥å£®å’Œç¨³å®šã€‚\nHN Ref: https://news.ycombinator.com/item?id=36400465\npg_easy_replicate å®ç°é›¶åœæœºçš„ Postgres ç‰ˆæœ¬è¿ç§» # shayonj/pg_easy_replicate Easily setup logical replication and switchover to new database with minimal downtime Ruby 731 7 pg_easy_replicate æ˜¯ä¸€ä¸ªå¼€æºçš„ Postgres é€»è¾‘å¤åˆ¶ CLI å·¥å…·ï¼Œå¯ä»¥å®ç°ä¸åŒç‰ˆæœ¬ PG ä¹‹é—´çš„æ•°æ®é€»è¾‘å¤åˆ¶ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„åœºæ™¯å®ç°é›¶æ•°æ®ä¸¢å¤±ã€æœ€å°åœæœºæ—¶é—´çš„ PG åœ¨çº¿å‡çº§ã€‚\nç±»ä¼¼é¡¹ç›®æœ‰ pgEdge äº 2022 å¹´å¼€æºçš„ PG æ‹“å±• Spockï¼š\npgEdge/spock pgEdge Multi-master Extension C 77 11 HN Refï¼š https://news.ycombinator.com/item?id=36405761\n","date":"22 June 2023","permalink":"/posts/hacker-news-digest-20230622/","section":"Posts","summary":"æ¢ç´¢äº‘åŸç”Ÿé¢†åŸŸçš„å¤šæ ·æ€§æ™¯è§‚, Quirky, Hashing, DevPod: æ— æœåŠ¡å•†é”å®šçš„ä»£ç å³å¼€å‘ç¯å¢ƒå¹³å°, Exit traps è®©ä½ çš„ Bash è„šæœ¬æ›´åŠ å¥å£®, pg_easy_replicate å®ç°é›¶åœæœºçš„ Postgres ç‰ˆæœ¬è¿ç§»","title":"Hacker News Digest - 2023.06.22"},{"content":" Reading on Craft.do Novelï¼šNotion é£æ ¼çš„æ–‡æœ¬ç¼–è¾‘å™¨ # steven-tey/novel Notion-style WYSIWYG editor with AI-powered autocompletion. TypeScript 8943 814 Novel æ˜¯ä¸€ä¸ªå¼€æºçš„ Notion é£æ ¼çš„ WYSIWYGï¼ˆæ‰€è§å³æ‰€å¾—ï¼‰æ–‡æœ¬ç¼–è¾‘å™¨ï¼ŒåŸºäº Next.jsã€TailwindCSS ç¼–å†™ï¼Œå¹¶å€ŸåŠ© OpenAI æä¾›äº† AI è‡ªåŠ¨è¡¥å…¨çš„ç‰¹æ€§ã€‚å…·æœ‰ååˆ†æµ“çƒˆçš„ Vercel å‘³ï¼Œæ¯•ç«Ÿæ˜¯ Vercel çš„ Senior DA Steven Tey çš„ä½œå“ã€‚\nSteven Tey æœ€è¿‘æœ‰ä¸€æœŸæ¥å— kfund é‡‡è®¿çš„å…³äºå¼€å‘è€…å…³ç³»çš„ Podcast ååˆ†å€¼å¾—ä¸€å¬ï¼š\n#PodKast 181 Steven Tey (Vercel): understanding the role of developer relations\nHN Refï¼š https://news.ycombinator.com/item?id=36360789\nBloopï¼šåŸºäº GPT-4 ä»£ç åº“é˜…è¯»å·¥å…· # BloopAI/bloop bloop is a fast code search engine written in Rust. TypeScript 7968 509 Bloop æ˜¯ä¸€ä¸ª Rust ç¼–å†™çš„ä»£ç æ£€ç´¢å¼•æ“ï¼ŒåŸºäº GPT-4 ä»¥è‡ªç„¶è¯­è¨€å¯¹è¯çš„æ–¹å¼æ¥æ£€ç´¢ã€å›ç­”æœ‰å…³ä»£ç åº“çš„é—®é¢˜ï¼Œæ”¯æŒæœ¬åœ°ã€è¿œç¨‹ Github ä»£ç ä»“åº“ä¸¤ç§æ¥æºã€‚è¿™å¯¹äºç†è§£é™Œç”Ÿé¡¹ç›®ååˆ†æœ‰æ•ˆï¼ŒåŒæ—¶æ”¯æŒåŸºäºå·²æœ‰ä¸Šä¸‹æ–‡ç¼–å†™æ–°ä»£ç ï¼Œç”±äºå¯¹ç´¢å¼•äº†æ•´ä½“ä»£ç ï¼Œä»ç»“æœçš„ç›¸å…³æ€§ä¸Šè¦ç•¥å¥½äº Github Copilotã€‚\nBloop çš„æŸ¥è¯¢ç´¢å¼•ç”± Tantivy å’Œ Qdrant æä¾›ï¼ŒTantivy æ˜¯ä¸€ä¸ª Rust ç¼–å†™çš„ç±»ä¼¼ Apache Lucene çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒQdrant æ˜¯ Rust ç¼–å†™çš„çŸ¢é‡æ•°æ®åº“ï¼Œè€Œå®¢æˆ·ç«¯åˆ™æ˜¯è¿™å‡ å¹´å¹¿å—æ¬¢è¿çš„ Tauriï¼ŒAll in Rust äº†å±äºæ˜¯ ğŸ¤£ã€‚\nå±å®è‰¯å¿ƒçš„æ˜¯ï¼ŒBloop çš„å…è´¹å¸æˆ·ç›®å‰æ²¡æœ‰ç¡¬æ€§é™åˆ¶ï¼Œåªæœ‰åœ¨ä¸ªäººè¶…è¿‡ 20 ä¸ªç”¨æˆ·æˆ– 100 ä¸ªåŒæ­¥ä»“åº“æ‰ä¼šé™ä½ç›¸åº”çš„æ€§èƒ½ã€‚\nHN Refï¼š https://news.ycombinator.com/item?id=36260961\nDolt: Git ç‰ˆæœ¬åŒ–æ•°æ® # dolthub/dolt Dolt â€“ Git for Data Go 15686 447 Dolt æ˜¯ä¸€ä¸ªä»¥ç±» Git è¿›è¡Œç‰ˆæœ¬æ§åˆ¶çš„ SQL æ•°æ®åº“ï¼Œå³ç±»ä¼¼ Git ä¸€æ ·çš„ forkã€cloneã€branchã€mergeã€pullã€push çš„æ“ä½œæ¥æ›´æ–°æ•°æ®ï¼ŒåŒæ—¶ä»¥ SQL æ¥æŸ¥è¯¢æ•°æ®ï¼Œå°±åƒGit å’Œ MySQL çš„ç¼åˆæ€ªï¼ˆIt\u0026rsquo;s like Git and MySQL had a babyï¼‰ã€‚\næ­¤å¤–ä»–ä»¬è¿˜åˆ›å»º DoltHub é¡¹ç›®ç”¨äºå…±äº«ç”¨æˆ·å…¬å¼€çš„ Dolt æ•°æ®ï¼Œè¿™ä¸ºè§£å†³å…¬å…±é¢†åŸŸçš„æ•°æ®é›†çš„å˜è¿ã€æº¯æºæä¾›äº†ä¸€ç§æ–°çš„æ€è·¯ã€‚\nhttps://www.dolthub.com/\nHN Refï¼š https://news.ycombinator.com/item?id=36152590\nï¼ˆåŸ HN å…¶å®æ˜¯è®¨è®º DoltHub ä¸Šä¸€ä¸ªç¾å›½ç¤¾åŒºåŒ»é™¢ä»·æ ¼æ•°æ®é›†çš„ XDï¼‰\nResend: ç°ä»£åŒ–é‚®ä»¶å‘é€ API å¹³å° # resend.com\nResend æä¾›äº†ä¸€ä¸ªç°ä»£åŒ–çš„é‚®ä»¶å‘é€å¹³å°ï¼Œä¸“æ³¨äºæä¾›æœ€ä½³çš„å¼€å‘äººå‘˜ä½“éªŒã€‚æ ¸å¿ƒå–ç‚¹æ˜¯å¯ä»¥åŸºäº React è€Œéè¿‡æ—¶çš„å¸ƒå±€æ¥ç¼–å†™å¤æ‚çš„ HTML é‚®ä»¶å†…å®¹ï¼ŒåŒæ—¶æä¾›é‚®ä»¶å‘é€çš„äº‹åŠ¡æ€§ã€å¯è§‚å¯Ÿæ€§å’Œé«˜é€Ÿæ€§èƒ½ã€‚\nHN Refï¼š https://news.ycombinator.com/item?id=36309120\né€šè¿‡ Stable Diffusion åˆ¶ä½œè‰ºæœ¯åŒ–çš„äºŒç»´ç  # How to make a QR code with Stable Diffusion - Stable Diffusion Art\næ–‡ç« ä»‹ç»äº†å¦‚ä½•é€šè¿‡ Stable Diffusion ControlNet æ‹“å±•ç”Ÿæˆè‰ºæœ¯åŒ–çš„äºŒç»´ç ã€‚\nHN Ref: https://news.ycombinator.com/item?id=36285630\nğŸ¦‘ Hacker News Digest Archive\n","date":"19 June 2023","permalink":"/posts/hacker-news-digest-20230619/","section":"Posts","summary":"Novelï¼šNotion é£æ ¼çš„æ–‡æœ¬ç¼–è¾‘å™¨, Bloopï¼šåŸºäº GPT-4 ä»£ç åº“é˜…è¯»å·¥å…·, Dolt: Git ç‰ˆæœ¬åŒ–æ•°æ®, Resend: ç°ä»£åŒ–é‚®ä»¶å‘é€ API å¹³å°, é€šè¿‡ Stable Diffusion åˆ¶ä½œè‰ºæœ¯åŒ–çš„äºŒç»´ç ","title":"Hacker News Digest - 2023.06.19"},{"content":"","date":"16 April 2023","permalink":"/tags/gpt/","section":"Tags","summary":"","title":"gpt"},{"content":" Reading on Craft.do èµ·å› æ˜¯åœ¨ 3 æœˆçš„æ—¶å€™åˆ·åˆ° Databend ai_to_sql çš„ä¸€æ¡ PRï¼š\nfeat: add ai_to_sql transalte natual lanauge to SQL based on your table schema by BohuTANG Â· Pull Request #10637 Â· datafuselabs/databend äºæ˜¯å°±å¼€å§‹å…³æ³¨ databend åœ¨ GPT-integration çš„åŠ¨å‘ï¼Œç„¶ååœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªæ˜ŸæœŸé‡Œï¼Œdatabend ä»¥ built-in functoin çš„å½¢å¼é™†ç»­å®ç°äº†ä¸€ç³»åˆ—åŸºäº OpenAI çš„æ‹“å±•åŠŸèƒ½ã€‚\nAI Functions | Databend\næ­£å½“æˆ‘çŒœæµ‹ Databend æ˜¯ä¸æ˜¯è¦å®ç°ä¸ª ChatDoc çš„æ—¶å€™ï¼Œ Askbend ä¸Šçº¿äº†ï¼Œç„¶åä½œä¸ºä¹å­äººçš„æˆ‘ä¸å‡ºæ„æ–™ç©åœ°å¾ˆå¼€å¿ƒã€‚ äºæ˜¯åœ¨è¯»äº†ä¸€é Askbend å’Œ Databend AI function ä»£ç çš„é‚£ä¸ªæ™šä¸Šï¼Œæˆ‘çªå‘å¥‡æƒ³ï¼Œä½•ä¸ä¹ä¸ŠåŠ ä¹ï¼Œæ‰‹æ“ä¸€ä¸ª Postgres çš„å®ç°ï¼Ÿ\nAskBend çš„å®ç° # AskBend çš„å®ç°æ–‡æ¡£æœç´¢çš„è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨ä»½ï¼šDoc Vector Embeddings \u0026amp; Queryã€‚\nå°†æ–‡æ¡£å†…å®¹åˆ†å‰²ä¸ºåˆé€‚é•¿åº¦çš„å°èŠ‚ï¼Œè®¡ç®—æ¯ä¸ªå°èŠ‚çš„ç‰¹å¾å‘é‡å¹¶å­˜å‚¨ã€‚ç”¨æˆ·æé—®æ—¶ï¼Œè®¡ç®—æé—®å†…å®¹çš„ç‰¹å¾å‘é‡ï¼Œå¹¶æŸ¥è¯¢ä½™å¼¦è·ç¦»æœ€è¿‘çš„å‡ ä¸ªæ–‡æ¡£å°èŠ‚ï¼Œç»„åˆæˆ Promt è°ƒç”¨ OpenAI Completion API è·å–ç»“æœã€‚\nå…¶ä¸­çš„å…³é”®æ­¥éª¤ Embedding è®¡ç®—ï¼Œå‘é‡ä½™å¼¦è·ç¦»è®¡ç®—ï¼Œè‡ªç„¶è¯­è¨€è¡¥å…¨ä¾èµ– Databend æ–°å®ç°çš„å‡ ä¸ª AI Functionï¼š\nai_embedding_vector ai_text_completion cosine_distance å®é™…ä¸Šé™¤äº† osine_distance ä¹‹å¤–ï¼Œå¦å¤–ä¸¤ä¸ªå‡½æ•°æ˜¯å¯¹ OpenAI API æ¯”è¾ƒç›´ç™½çš„è°ƒç”¨å°è£…ï¼Œè™½ç„¶ OpenAI çš„ embedding è´¨é‡ä¸€èˆ¬ï¼Œä½†æ˜¯èƒœåœ¨çœäº‹ ğŸ¤£ã€‚\nè®©æˆ‘ä»¬æ¥è¿›ä¸€æ­¥åˆ†æè¿™ä¸¤ä¸ªè¿‡ç¨‹çš„å…·ä½“å®ç°ï¼Œè®©æˆ‘çœ‹çœ‹.jpgã€‚\næ–‡æ¡£åµŒå…¥è¿‡ç¨‹ # ç«¯ç‚¹ä»£ç ä½äº https://github.com/datafuselabs/askbend/blob/main/app/bin/ask.rs#L47ï¼ŒAksBend å®ç°ä¸ºä¸€ä¸ª CLI-Toolã€‚\nStep-1: æ–‡æ¡£è§£æ # askbend/markdown.rs at main Â· datafuselabs/askbend\néå†ç›®æ ‡æ–‡æ¡£ç›®å½•ä¸‹çš„æ‰€æœ‰ Markdownï¼Œå°†å…¶æŒ‰ç…§ Heading åˆ†å‰²ä¸ºå†…å®¹å°èŠ‚ï¼ŒåŒæ—¶å°†é•¿åº¦å°äº min_section_len (é»˜è®¤ 1024) çš„å°èŠ‚åˆå¹¶åˆ°ä¸Šä¸€ä¸ªå°èŠ‚ï¼Œé¿å…è¿‡çŸ­çš„å†…å®¹å°èŠ‚ã€‚\nè¿™ç§åˆ†å‰²æ–¹å¼ååˆ†åœ°æš´åŠ›ï¼ŒæŸä¸ªå°èŠ‚é‡Œå¾ˆå®¹æ˜“å‡ºç°ç›¸å…³æ€§è¾ƒä½çš„å†…å®¹ï¼Œæ¯”å¦‚æŸä¸€ä¸ª H1 çš„å°èŠ‚å› ä¸ºé•¿åº¦è¿‡çŸ­æŠ˜å åˆ°äº†ä¸Šä¸€ä¸ªç›¸å…³æ€§å¾ˆä½ H2 çš„å°èŠ‚é‡Œï¼Œæ›´å¤æ‚çš„å†…å®¹åˆ’åˆ†ç®—æ³•è®¾è®¡å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥ â€œå…ˆå®ç°äº†å†è¯´â€ å¤§æ¦‚æ˜¯è™å“¥å½“æ—¶è„‘æµ·ä¸­çš„æƒ³æ³•ï¼Œè¿™ååˆ†åœ°åˆç†ï¼ˆbushiã€‚\nStep-2: å­˜å‚¨æ–‡æ¡£å°èŠ‚ # askbend/db.rs at 7babbdb197f573bdb462fedc2a31be206114e8bd Â· datafuselabs/askbend\nå°† Step-1 çš„è§£æç»“æœå†™å…¥ä»¥ä¸‹ç»“æ„çš„è¡¨ä¸­ï¼š\nCREATE TABLE doc ( path VARCHAR, content VARCHAR, embedding ARRAY(FLOAT32) ); Step-3: è®¡ç®—èŠ‚é€‰ Embedding # askbend/db.rs at main Â· datafuselabs/askbend\nè°ƒç”¨ Databend ai_embedding_vector è®¡ç®—æ‰€æœ‰å°èŠ‚é™å®šæœ€å¤§å†…å®¹é•¿åº¦çš„ vector embeddingã€‚\nUPDATE {{ database }}.{{ table }} SET embedding = ai_embedding_vector(left(concat(path, content),{{max_content_length}})) WHERE length(embedding)=0\u0026#34; ai_embedding_vector å®é™…ä¸Šæ˜¯å¯¹ OpenAI Embeddings API çš„è°ƒç”¨å°è£…ï¼Œä½¿ç”¨äº† text-embedding-ada-002 ï¼Œæœ€å¤§è¾“å…¥ token æ˜¯ 8191ï¼Œ è¾“å‡ºå°ºå¯¸ä¸º 1536ã€‚\nEmbedding ä¸€ç§å¸¸ç”¨çš„ç¦»æ•£ç‰¹å¾çš„é«˜çº¬å‘é‡æŠ•å°„æ–¹å¼ï¼Œå…¶ä¸­æœ€å¤§çš„é—®é¢˜åœ¨äºä¸åŒç”Ÿæˆç®—æ³•å’Œè¯­æ–™é€ æˆçš„ç„å­¦é—®é¢˜ï¼Œå°¤å…¶æ˜¯æ¶æ¢¦ä¸€èˆ¬çš„è°ƒå‚ç‚¼ä¸¹è¿‡ç¨‹ï¼Œè‡ªè¡Œå®ç°è¦è¾¾åˆ°æ¯”è¾ƒå¥½çš„æ•ˆæœæˆæœ¬ä¸ä½ã€‚\næ‰€ä»¥åŸæ±¤åŒ–åŸé£Ÿï¼Œæˆ‘å‡ºé’± OpenAI å‡ºåŠ›ï¼Œç¾äº‹ä¸€æ¡©ï¼Œå†µä¸”åœ¨è¿™ç§ä¸€æ¬¡æ€§å°è§„æ¨¡åœºæ™¯ä¸Šï¼Œä¹Ÿå°±ä¸åˆ°ä¸€ç¾å…ƒçš„å¼€é”€ã€‚\næ–‡æ¡£æŸ¥è¯¢è¿‡ç¨‹ # æ–­ç‚¹ä»£ç ä½äºï¼š askbend/app/src/dal/db.rs#L169\nStep-1ï¼šè®¡ç®— Input æ–‡æœ¬çš„ Embedding # askbend/db.rs at main Â· datafuselabs/askbend\nåŒæ ·åœ°ï¼Œå®é™…æ˜¯é€šè¿‡ ai_embedding_vector è°ƒç”¨ OpenAI Embeddings APIï¼Œè·å–ç”¨æˆ·è¾“å…¥æ–‡æœ¬çš„ Embedding Vectorã€‚\nStep-2: è·å–ç›¸ä¼¼å†…å®¹å°èŠ‚ # askbend/db.rs at main Â· datafuselabs/askbend\nè·å– Step-1 çš„ Vector ç»“æœä½™å¼¦è·ç¦»æœ€è¿‘çš„ N ä¸ªå†…å®¹å°èŠ‚ï¼š\nSELECT content, distance FROM ( SELECT content, cosine_distance({{ query_embedding }}, embedding) AS distance FROM {{ database }}.{{ table }} WHERE length(embedding) \u0026gt; 0 AND length(content) \u0026gt; {{ min_content_lenggth }} ORDER BY distance ASC LIMIT {{ top }} ) WHERE distance \u0026lt;= {{ min_distince }} Step-3: ä» OpenAI API è·å–ç»“æœè¡¥å…¨ # askbend/db.rs at main Â· datafuselabs/askbend\næ–‡æ¡£å°èŠ‚å’Œç”¨æˆ·é—®é¢˜ç»„è£…çš„ prompt æ ¼å¼ä¸ºï¼š\nDocumentation sections: {{context}} Question: {{query}} æ¥ç€é€šè¿‡ Databend ai_text_completion å‡½æ•°è·å–è¡¥å…¨ç»“æœï¼š\nSELECT ai_text_completio(\u0026#34;\u0026lt;prompt\u0026gt;\u0026#34;) ai_text_completion å®é™…ä¸Šæ˜¯å¯¹ Open AI Text Completion API çš„å°è£…è°ƒç”¨ï¼Œä½¿ç”¨ text-davinci-003 æ¨¡å‹ã€‚\nä¸ªäººæ„Ÿè§‰æ›´æ¢ä¸º Chat Completion APIï¼Œä½¿ç”¨ gpt-3.5-turbo æˆ– gpt-4 æ¨¡å‹ï¼Œè®¾è®¡å¥½ prompt ä¸è¦è®© gpt èƒ¡è¨€ä¹±è¯­å¯ä»¥æœ‰æ›´å¥½çš„è¿”å›ç»“æœã€‚\nä¸­åœº # ä»¥ä¸Šå°±æ˜¯æ•´ä¸ª AskBend çš„å®ç°è¿‡ç¨‹ï¼Œè™½ç„¶è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒèµ¶çš„é¡¹ç›®äº§ç‰©ï¼Œä½†æ˜¯åœ¨å¾ˆçŸ­æ˜¯å®ç°å‘¨æœŸå†…ï¼Œå€ŸåŠ© OpenAI ååˆ†å·§å¦™åœ°å®ç°äº†ä¸€ä¸ª SQL-based knowledgeï¼Œæ˜¯ä¸ªå¾ˆæ£’çš„é¡¹ç›®ğŸ˜ƒã€‚\nåŠ ä¸Š Databend æ›´æ—©å®ç° ai_to_sqlï¼Œæ•´ä¸ªæ€è·¯å¯ä»¥åœ¨å¤§éƒ¨ä»½æ”¯æŒå‘é‡è®¡ç®—çš„ Database é‡Œå®ç°å‡ºæ¥ï¼Œå°¤å…¶æ˜¯æ”¯æŒ UDF çš„ Databse é‡Œå¯ä»¥ååˆ†å¿«é€Ÿåœ°æ•´æ´»ï¼Œè¹­ GPT çš„çƒ­åº¦å¯å¤ªä¹äº†ã€‚\nåœ¨ Postgres ä¸Šå¤åˆ»ï¼ # ä½œä¸ºä¸€ä¸ªç½‘è·¯ä¹å­äººï¼Œæˆ‘å½“ç„¶ä¸èƒ½é”™è¿‡è¿™ä¹ˆæœ‰æ„æ€çš„æ•´æ´»ï¼Œäºæ˜¯æˆ‘èŠ±äº†ä¸€ä¸ªå‘¨æœ«åœ¨ Postgres ä¸Šå¤åˆ» AskBend ğŸ¤£ã€‚\né¡¹ç›® Githubï¼š https://github.com/Al-assad/postgres-gpt\nPostgres å…·å¤‡äº† 2 ä¸ªåŸºæœ¬æ¡ä»¶ï¼š\npgvectorï¼šæ‹“å±•æ”¯æŒå‘é‡ç»“æ„çš„å­˜å‚¨ï¼Œå’Œç®€å•çš„è·ç¦»è®¡ç®—ç®—æ³•ï¼ˆä½™å¼¦/å†…ç§¯è·ç¦»ï¼‰ï¼› pl/pythonï¼šååˆ†æ–¹ä¾¿çš„ python udf ç¼–å†™ï¼Œopenai æä¾›çš„ python sdk ç›´æ¥æŠ„ï¼› å®ç°å½¢å¼æ˜¯ååˆ†è½»é‡çš„ Postgres Python UDFï¼Œç”¨æˆ·å¼€å‘ä¿®æ”¹å¯ä»¥ç›´æ¥åœ¨çº¿ä¿®æ”¹ç›¸å…³å‡½æ•°çš„å®ç°ä»£ç ï¼Œç›¸å…³çš„å®ç°åŸºæœ¬æ˜¯åƒç´ çº§ä¸€æ¯”ä¸€æŠ„ Askbendï¼Œåªä¸è¿‡æ”¹è¿›äº†æ–‡æ¡£æŸ¥è¯¢ä¸º Chat Completion æ–¹å¼ï¼Œè®¾è®¡äº†ä»¥ä¸‹çš„ System Promptï¼š\nYou are an assistant with the following background knowledge: {{documentation}} å®é™…ä»ç”¨æˆ·æ„å›¾çš„ç†è§£ä¸Šçœ‹ï¼Œè¦å¥½äº Text Completion æ–¹å¼ï¼Œåªä¸è¿‡è¿˜æ˜¯æœ‰æ¦‚ç‡å‘ç”Ÿ Chat Completion èƒ¡è¨€ä¹±è¯­çš„ä¼ ç»Ÿè‰ºèƒ½ã€‚\n","date":"16 April 2023","permalink":"/posts/replicate-askbend-on-postgres/","section":"Posts","summary":"èµ·å› æ˜¯åœ¨ 3 æœˆçš„æ—¶å€™åˆ·åˆ° Databend ai_to_sql çš„ä¸€æ¡ PR, feat: add ai_to_sql transalte natual lanauge to SQL based on your table schema by BohuTANG \u0026hellip;","title":"åœ¨ Postgres ä¸Šå¤åˆ» AskBendï¼"},{"content":"","date":"13 June 2022","permalink":"/posts/","section":"Posts","summary":"","title":"Posts"},{"content":"","date":"1 January 0001","permalink":"/authors/","section":"Authors","summary":"","title":"Authors"},{"content":"","date":"1 January 0001","permalink":"/categories/","section":"Categories","summary":"","title":"Categories"},{"content":"","date":"1 January 0001","permalink":"/series/","section":"Series","summary":"","title":"Series"}]