[{"content":"A software engineer who occasionally ponders some odd questions.\nFunctional programming fanatic with a focus on Scala3, Akka and Big Data Domain.\n","date":"16 April 2023","permalink":"/","section":"","summary":"A software engineer who occasionally ponders some odd questions.\nFunctional programming fanatic with a focus on Scala3, Akka and Big Data Domain.","title":""},{"content":"","date":"16 April 2023","permalink":"/tags/gpt/","section":"Tags","summary":"","title":"gpt"},{"content":"","date":"16 April 2023","permalink":"/tags/postgres/","section":"Tags","summary":"","title":"postgres"},{"content":"","date":"16 April 2023","permalink":"/tags/","section":"Tags","summary":"","title":"Tags"},{"content":" ğŸ¦‘ Reading on Craft\nèµ·å› æ˜¯åœ¨ 3 æœˆçš„æ—¶å€™åˆ·åˆ° Databend ai_to_sql çš„ä¸€æ¡ PRï¼š\nfeat: add ai_to_sql transalte natual lanauge to SQL based on your table schema by BohuTANG Â· Pull Request #10637 Â· datafuselabs/databend äºæ˜¯å°±å¼€å§‹å…³æ³¨ databend åœ¨ GPT-integration çš„åŠ¨å‘ï¼Œç„¶ååœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªæ˜ŸæœŸé‡Œï¼Œdatabend ä»¥ built-in functoin çš„å½¢å¼é™†ç»­å®ç°äº†ä¸€ç³»åˆ—åŸºäº OpenAI çš„æ‹“å±•åŠŸèƒ½ã€‚\nAI Functions | Databend\næ­£å½“æˆ‘çŒœæµ‹ Databend æ˜¯ä¸æ˜¯è¦å®ç°ä¸ª ChatDoc çš„æ—¶å€™ï¼Œ Askbend ä¸Šçº¿äº†ï¼Œç„¶åä½œä¸ºä¹å­äººçš„æˆ‘ä¸å‡ºæ„æ–™ç©åœ°å¾ˆå¼€å¿ƒã€‚ äºæ˜¯åœ¨è¯»äº†ä¸€é Askbend å’Œ Databend AI function ä»£ç çš„é‚£ä¸ªæ™šä¸Šï¼Œæˆ‘çªå‘å¥‡æƒ³ï¼Œä½•ä¸ä¹ä¸ŠåŠ ä¹ï¼Œæ‰‹æ“ä¸€ä¸ª Postgres çš„å®ç°ï¼Ÿ\nAskBend çš„å®ç°\u003e AskBend çš„å®ç° # AskBend çš„å®ç°æ–‡æ¡£æœç´¢çš„è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨ä»½ï¼šDoc Vector Embeddings \u0026amp; Queryã€‚\nå°†æ–‡æ¡£å†…å®¹åˆ†å‰²ä¸ºåˆé€‚é•¿åº¦çš„å°èŠ‚ï¼Œè®¡ç®—æ¯ä¸ªå°èŠ‚çš„ç‰¹å¾å‘é‡å¹¶å­˜å‚¨ã€‚ç”¨æˆ·æé—®æ—¶ï¼Œè®¡ç®—æé—®å†…å®¹çš„ç‰¹å¾å‘é‡ï¼Œå¹¶æŸ¥è¯¢ä½™å¼¦è·ç¦»æœ€è¿‘çš„å‡ ä¸ªæ–‡æ¡£å°èŠ‚ï¼Œç»„åˆæˆ Promt è°ƒç”¨ OpenAI Completion API è·å–ç»“æœã€‚\nå…¶ä¸­çš„å…³é”®æ­¥éª¤ Embedding è®¡ç®—ï¼Œå‘é‡ä½™å¼¦è·ç¦»è®¡ç®—ï¼Œè‡ªç„¶è¯­è¨€è¡¥å…¨ä¾èµ– Databend æ–°å®ç°çš„å‡ ä¸ª AI Functionï¼š\nai_embedding_vector ai_text_completion cosine_distance å®é™…ä¸Šé™¤äº† osine_distance ä¹‹å¤–ï¼Œå¦å¤–ä¸¤ä¸ªå‡½æ•°æ˜¯å¯¹ OpenAI API æ¯”è¾ƒç›´ç™½çš„è°ƒç”¨å°è£…ï¼Œè™½ç„¶ OpenAI çš„ embedding è´¨é‡ä¸€èˆ¬ï¼Œä½†æ˜¯èƒœåœ¨çœäº‹ ğŸ¤£ã€‚\nè®©æˆ‘ä»¬æ¥è¿›ä¸€æ­¥åˆ†æè¿™ä¸¤ä¸ªè¿‡ç¨‹çš„å…·ä½“å®ç°ï¼Œè®©æˆ‘çœ‹çœ‹.jpgã€‚\næ–‡æ¡£åµŒå…¥è¿‡ç¨‹\u003e æ–‡æ¡£åµŒå…¥è¿‡ç¨‹ # ç«¯ç‚¹ä»£ç ä½äº https://github.com/datafuselabs/askbend/blob/main/app/bin/ask.rs#L47ï¼ŒAksBend å®ç°ä¸ºä¸€ä¸ª CLI-Toolã€‚\nStep-1: æ–‡æ¡£è§£æ\u003e Step-1: æ–‡æ¡£è§£æ # askbend/markdown.rs at main Â· datafuselabs/askbend\néå†ç›®æ ‡æ–‡æ¡£ç›®å½•ä¸‹çš„æ‰€æœ‰ Markdownï¼Œå°†å…¶æŒ‰ç…§ Heading åˆ†å‰²ä¸ºå†…å®¹å°èŠ‚ï¼ŒåŒæ—¶å°†é•¿åº¦å°äº min_section_len (é»˜è®¤ 1024) çš„å°èŠ‚åˆå¹¶åˆ°ä¸Šä¸€ä¸ªå°èŠ‚ï¼Œé¿å…è¿‡çŸ­çš„å†…å®¹å°èŠ‚ã€‚\nè¿™ç§åˆ†å‰²æ–¹å¼ååˆ†åœ°æš´åŠ›ï¼ŒæŸä¸ªå°èŠ‚é‡Œå¾ˆå®¹æ˜“å‡ºç°ç›¸å…³æ€§è¾ƒä½çš„å†…å®¹ï¼Œæ¯”å¦‚æŸä¸€ä¸ª H1 çš„å°èŠ‚å› ä¸ºé•¿åº¦è¿‡çŸ­æŠ˜å åˆ°äº†ä¸Šä¸€ä¸ªç›¸å…³æ€§å¾ˆä½ H2 çš„å°èŠ‚é‡Œï¼Œæ›´å¤æ‚çš„å†…å®¹åˆ’åˆ†ç®—æ³•è®¾è®¡å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥ â€œå…ˆå®ç°äº†å†è¯´â€ å¤§æ¦‚æ˜¯è™å“¥å½“æ—¶è„‘æµ·ä¸­çš„æƒ³æ³•ï¼Œè¿™ååˆ†åœ°åˆç†ï¼ˆbushiã€‚\nStep-2: å­˜å‚¨æ–‡æ¡£å°èŠ‚\u003e Step-2: å­˜å‚¨æ–‡æ¡£å°èŠ‚ # askbend/db.rs at 7babbdb197f573bdb462fedc2a31be206114e8bd Â· datafuselabs/askbend\nå°† Step-1 çš„è§£æç»“æœå†™å…¥ä»¥ä¸‹ç»“æ„çš„è¡¨ä¸­ï¼š\nCREATE TABLE doc ( path VARCHAR, content VARCHAR, embedding ARRAY(FLOAT32) ); Step-3: è®¡ç®—èŠ‚é€‰ Embedding\u003e Step-3: è®¡ç®—èŠ‚é€‰ Embedding # askbend/db.rs at main Â· datafuselabs/askbend\nè°ƒç”¨ Databend ai_embedding_vector è®¡ç®—æ‰€æœ‰å°èŠ‚é™å®šæœ€å¤§å†…å®¹é•¿åº¦çš„ vector embeddingã€‚\nUPDATE {{ database }}.{{ table }} SET embedding = ai_embedding_vector(left(concat(path, content),{{max_content_length}})) WHERE length(embedding)=0\u0026#34; ai_embedding_vector å®é™…ä¸Šæ˜¯å¯¹ OpenAI Embeddings API çš„è°ƒç”¨å°è£…ï¼Œä½¿ç”¨äº† text-embedding-ada-002 ï¼Œæœ€å¤§è¾“å…¥ token æ˜¯ 8191ï¼Œ è¾“å‡ºå°ºå¯¸ä¸º 1536ã€‚\nEmbedding ä¸€ç§å¸¸ç”¨çš„ç¦»æ•£ç‰¹å¾çš„é«˜çº¬å‘é‡æŠ•å°„æ–¹å¼ï¼Œå…¶ä¸­æœ€å¤§çš„é—®é¢˜åœ¨äºä¸åŒç”Ÿæˆç®—æ³•å’Œè¯­æ–™é€ æˆçš„ç„å­¦é—®é¢˜ï¼Œå°¤å…¶æ˜¯æ¶æ¢¦ä¸€èˆ¬çš„è°ƒå‚ç‚¼ä¸¹è¿‡ç¨‹ï¼Œè‡ªè¡Œå®ç°è¦è¾¾åˆ°æ¯”è¾ƒå¥½çš„æ•ˆæœæˆæœ¬ä¸ä½ã€‚\næ‰€ä»¥åŸæ±¤åŒ–åŸé£Ÿï¼Œæˆ‘å‡ºé’± OpenAI å‡ºåŠ›ï¼Œç¾äº‹ä¸€æ¡©ï¼Œå†µä¸”åœ¨è¿™ç§ä¸€æ¬¡æ€§å°è§„æ¨¡åœºæ™¯ä¸Šï¼Œä¹Ÿå°±ä¸åˆ°ä¸€ç¾å…ƒçš„å¼€é”€ã€‚\næ–‡æ¡£æŸ¥è¯¢è¿‡ç¨‹\u003e æ–‡æ¡£æŸ¥è¯¢è¿‡ç¨‹ # æ–­ç‚¹ä»£ç ä½äºï¼š askbend/app/src/dal/db.rs#L169\nStep-1ï¼šè®¡ç®— Input æ–‡æœ¬çš„ Embedding\u003e Step-1ï¼šè®¡ç®— Input æ–‡æœ¬çš„ Embedding # askbend/db.rs at main Â· datafuselabs/askbend\nåŒæ ·åœ°ï¼Œå®é™…æ˜¯é€šè¿‡ ai_embedding_vector è°ƒç”¨ OpenAI Embeddings APIï¼Œè·å–ç”¨æˆ·è¾“å…¥æ–‡æœ¬çš„ Embedding Vectorã€‚\nStep-2: è·å–ç›¸ä¼¼å†…å®¹å°èŠ‚\u003e Step-2: è·å–ç›¸ä¼¼å†…å®¹å°èŠ‚ # askbend/db.rs at main Â· datafuselabs/askbend\nè·å– Step-1 çš„ Vector ç»“æœä½™å¼¦è·ç¦»æœ€è¿‘çš„ N ä¸ªå†…å®¹å°èŠ‚ï¼š\nSELECT content, distance FROM ( SELECT content, cosine_distance({{ query_embedding }}, embedding) AS distance FROM {{ database }}.{{ table }} WHERE length(embedding) \u0026gt; 0 AND length(content) \u0026gt; {{ min_content_lenggth }} ORDER BY distance ASC LIMIT {{ top }} ) WHERE distance \u0026lt;= {{ min_distince }} Step-3: ä» OpenAI API è·å–ç»“æœè¡¥å…¨\u003e Step-3: ä» OpenAI API è·å–ç»“æœè¡¥å…¨ # askbend/db.rs at main Â· datafuselabs/askbend\næ–‡æ¡£å°èŠ‚å’Œç”¨æˆ·é—®é¢˜ç»„è£…çš„ prompt æ ¼å¼ä¸ºï¼š\nDocumentation sections: {{context}} Question: {{query}} æ¥ç€é€šè¿‡ Databend ai_text_completion å‡½æ•°è·å–è¡¥å…¨ç»“æœï¼š\nSELECT ai_text_completio(\u0026#34;\u0026lt;prompt\u0026gt;\u0026#34;) ai_text_completion å®é™…ä¸Šæ˜¯å¯¹ Open AI Text Completion API çš„å°è£…è°ƒç”¨ï¼Œä½¿ç”¨ text-davinci-003 æ¨¡å‹ã€‚\nä¸ªäººæ„Ÿè§‰æ›´æ¢ä¸º Chat Completion APIï¼Œä½¿ç”¨ gpt-3.5-turbo æˆ– gpt-4 æ¨¡å‹ï¼Œè®¾è®¡å¥½ prompt ä¸è¦è®© gpt èƒ¡è¨€ä¹±è¯­å¯ä»¥æœ‰æ›´å¥½çš„è¿”å›ç»“æœã€‚\nä¸­åœº\u003e ä¸­åœº # ä»¥ä¸Šå°±æ˜¯æ•´ä¸ª AskBend çš„å®ç°è¿‡ç¨‹ï¼Œè™½ç„¶è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒèµ¶çš„é¡¹ç›®äº§ç‰©ï¼Œä½†æ˜¯åœ¨å¾ˆçŸ­æ˜¯å®ç°å‘¨æœŸå†…ï¼Œå€ŸåŠ© OpenAI ååˆ†å·§å¦™åœ°å®ç°äº†ä¸€ä¸ª SQL-based knowledgeï¼Œæ˜¯ä¸ªå¾ˆæ£’çš„é¡¹ç›®ğŸ˜ƒã€‚\nåŠ ä¸Š Databend æ›´æ—©å®ç° ai_to_sqlï¼Œæ•´ä¸ªæ€è·¯å¯ä»¥åœ¨å¤§éƒ¨ä»½æ”¯æŒå‘é‡è®¡ç®—çš„ Database é‡Œå®ç°å‡ºæ¥ï¼Œå°¤å…¶æ˜¯æ”¯æŒ UDF çš„ Databse é‡Œå¯ä»¥ååˆ†å¿«é€Ÿåœ°æ•´æ´»ï¼Œè¹­ GPT çš„çƒ­åº¦å¯å¤ªä¹äº†ã€‚\nåœ¨ Postgres ä¸Šå¤åˆ»ï¼\u003e åœ¨ Postgres ä¸Šå¤åˆ»ï¼ # ä½œä¸ºä¸€ä¸ªç½‘è·¯ä¹å­äººï¼Œæˆ‘å½“ç„¶ä¸èƒ½é”™è¿‡è¿™ä¹ˆæœ‰æ„æ€çš„æ•´æ´»ï¼Œäºæ˜¯æˆ‘èŠ±äº†ä¸€ä¸ªå‘¨æœ«åœ¨ Postgres ä¸Šå¤åˆ» AskBend ğŸ¤£ã€‚\né¡¹ç›® Githubï¼š https://github.com/Al-assad/postgres-gpt\nPostgres å…·å¤‡äº† 2 ä¸ªåŸºæœ¬æ¡ä»¶ï¼š\npgvectorï¼šæ‹“å±•æ”¯æŒå‘é‡ç»“æ„çš„å­˜å‚¨ï¼Œå’Œç®€å•çš„è·ç¦»è®¡ç®—ç®—æ³•ï¼ˆä½™å¼¦/å†…ç§¯è·ç¦»ï¼‰ï¼› pl/pythonï¼šååˆ†æ–¹ä¾¿çš„ python udf ç¼–å†™ï¼Œopenai æä¾›çš„ python sdk ç›´æ¥æŠ„ï¼› å®ç°å½¢å¼æ˜¯ååˆ†è½»é‡çš„ Postgres Python UDFï¼Œç”¨æˆ·å¼€å‘ä¿®æ”¹å¯ä»¥ç›´æ¥åœ¨çº¿ä¿®æ”¹ç›¸å…³å‡½æ•°çš„å®ç°ä»£ç ï¼Œç›¸å…³çš„å®ç°åŸºæœ¬æ˜¯åƒç´ çº§ä¸€æ¯”ä¸€æŠ„ Askbendï¼Œåªä¸è¿‡æ”¹è¿›äº†æ–‡æ¡£æŸ¥è¯¢ä¸º Chat Completion æ–¹å¼ï¼Œè®¾è®¡äº†ä»¥ä¸‹çš„ System Promptï¼š\nYou are an assistant with the following background knowledge: {{documentation}} å®é™…ä»ç”¨æˆ·æ„å›¾çš„ç†è§£ä¸Šçœ‹ï¼Œè¦å¥½äº Text Completion æ–¹å¼ï¼Œåªä¸è¿‡è¿˜æ˜¯æœ‰æ¦‚ç‡å‘ç”Ÿ Chat Completion èƒ¡è¨€ä¹±è¯­çš„ä¼ ç»Ÿè‰ºèƒ½ã€‚\n","date":"16 April 2023","permalink":"/posts/replicate-askbend-on-postgres/","section":"Posts","summary":"èµ·å› æ˜¯åœ¨ 3 æœˆçš„æ—¶å€™åˆ·åˆ° Databend ai_to_sql çš„ä¸€æ¡ PR, feat: add ai_to_sql transalte natual lanauge to SQL based on your table schema by BohuTANG \u0026hellip;","title":"åœ¨ Postgres ä¸Šå¤åˆ» AskBendï¼"},{"content":"","date":"13 June 2022","permalink":"/posts/","section":"Posts","summary":"","title":"Posts"},{"content":"","date":"1 January 0001","permalink":"/authors/","section":"Authors","summary":"","title":"Authors"},{"content":"","date":"1 January 0001","permalink":"/categories/","section":"Categories","summary":"","title":"Categories"},{"content":"","date":"1 January 0001","permalink":"/series/","section":"Series","summary":"","title":"Series"}]